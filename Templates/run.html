{% extends "layout.html"%}
{%block content%}
<br />
<br />
<br />
<main role="main">
    <div class="container marketing">
        <div class="row">
            <div class='col-lg-4' style="float:left; text-align:center;">
                <h1>Time</h1>
                <h1 id='time'>0:0:0</h1>

            </div>
            <div class="col-lg-4 text-center">
                <a style="background-color:#4f98ca ; color: white ; border: 1px solid #4f98ca; font-size: 2em; width: 105%;"
                    class="btn btn-lg btn-primary" role="button" onclick='start()' id='startBtn'>Start</a>
                <a style="background-color:red ; color: white ; border: 1px solid red; font-size: 2em; width: 105%;"
                    class="hide btn btn-lg btn-primary" role="button" onclick='stop()' id='stopBtn'>Stop</a>
            </div>
            <div class="col-lg-4" style="float: right; text-align: center;">
                <h1>Miles</h1>
                <h1 id='miles'>0.00</h1>
            </div>
            <div class="col-lg-8 ">
                <h4 style="float: right;">Weather:<a id='weatherResults'></a></h4>
            </div>
        </div>

        <hr class="featurette-divider">
    </div>


    <div id="map" style="position: absolute; margin-left:25%;margin-right:25%;width:50%;height: 70%;"></div>

</main>
<script>
    let hours = 0;
    let minutes = 0;
    let seconds = 0;
    let startCheck;
    let line = [];
    let timerFunctionCounter = 0; //<- so function only runs once
    function stop() {//<- on stop button click
        startCheck = false;
        $('#stopBtn').addClass('hide')
        $('#startBtn').removeClass('hide')
    }
    function start() {//<- on start button click
        if (timerFunctionCounter === 0) {//function only runsz once
            timer()
            timerFunctionCounter++;
        }
        startCheck = true;
        hours = 0;
        minutes = 0;//make everything start at 0 on each run
        seconds = 0;
        $('#startBtn').addClass('hide')
        $('#stopBtn').removeClass('hide')
    }
    function timer() {


        setInterval(function () {
            if (startCheck === true) {
                document.getElementById('time').innerHTML = ''
                document.getElementById('time').innerHTML += hours + ':' + minutes + ':' + seconds;
                seconds++;
                if (seconds > 60) {
                    minutes++;
                    seconds = 0;
                    if (minutes > 60) {
                        hours++;
                        minutes = 0;
                    }
                }
            }
        }, 1000)
    }
   // if (startCheck === true) {//function runs on every location change
        navigator.geolocation.watchPosition(pos => {
            let m = pos.coords.longitude;
            line.push[m  ]
            console.log(pos.coords.longitude)
            console.log(line)
        }, (error) => { window.alert(error) }, { enableHighAccuracy: true })
  //  }
    let map = L.map('map').setView([0, 0], 2);
    let posIcon = new L.Icon({
        iconUrl: 'https://api.geoapify.com/v1/icon/?type=circle&color=%234f98ca&size=small&icon=Circle&iconType=awesome&iconSize=small&strokeColor=%230346ff&noWhiteCircle&apiKey=c95f29ee641d4197bb612d71b4d6c435'
    })
    var myStyle = {
        "color": "#272727",
        "weight": 5,
        "opacity": 0.65
    };
    /*var myLines = [{//geoJson line
        "type": "LineString",
        "coordinates": [
            [-100, 40],
            [-105, 45],
            [-110, 55]
        ]
    }];
    var linesFeatureLayer = L.geoJSON(myLines, {
        style: myStyle
    });*/


   // linesFeatureLayer.addTo(map);
    api_key =
        'c8ae987d039ba96d612968e4e689a032' // url = `api.openweathermap.org/data/2.5/weather?q={city name},{state}&appid=${api_key}`
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(//on page load checks if geolocation works and then gets weather data 
            async (position) => {


                let response = await axios.get('https://api.openweathermap.org/data/2.5/weather?lat=' +
                    position.coords.latitude + '&lon=' + position.coords.longitude +
                    '&appid=c8ae987d039ba96d612968e4e689a032&units=imperial');
                document.getElementById('weatherResults').innerHTML += response.data.name + ', ' + response
                    .data.weather[0].main + ', ' + response.data.main.temp + '&#8457;';


            })
    } else {
        window.alert('Geolocation Failed!')
    }

    L.tileLayer('https://api.maptiler.com/maps/streets/{z}/{x}/{y}.png?key=gFX05mk9hDIatdpgPG7C', {
        attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">&copy; MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">&copy; OpenStreetMap contributors</a>',
        maxZoom: 18,
        tileSize: 512,
        zoomOffset: -1,
        zoomControl: false

    }).addTo(map);
    map.locate({//always zooms in on location
        watch: true,
        setView: true,
        maxZoom: 16
    }).on('locationfound', (e) => {
        if (!this.marker) {
            this.marker = L.marker([e.latitude, e.longitude], {
                icon: posIcon,
            }).addTo(map);
        } else {
            this.marker.setLatLng([e.latitude, e.longitude]);
        }
    })
</script>
</div>
{% endblock content%}